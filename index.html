<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>7alan Mart — Single File App</title>
<meta name="description" content="7alan Mart demo app — single file (HTML/CSS/JS) with admin sold toggles, cart, WhatsApp order, delivery timer." />
<style>
  /* ---------- Variables + Base ---------- */
  *{box-sizing:border-box}
  :root{
    --bg:#0f0f10;
    --panel:#181818;
    --panel-2:#1f1f1f;
    --text:#ffffff;
    --muted:#bdbdbd;
    --accent:#fffb00;
    --danger:#ff3b3b;
    --radius:14px;
    --glass: rgba(255,255,255,0.02);
  }
  html,body{height:100%}
  body{
    margin:0;
    font-family: Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;
    background:linear-gradient(180deg,#0b0b0b 0%, #0f0f10 100%);
    color:var(--text);
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }
  a{color:inherit;text-decoration:none}

  /* ---------- Topbar ---------- */
  .topbar{
    display:grid;grid-template-columns:1fr auto 1fr;align-items:center;
    gap:8px;padding:12px 18px;background:var(--panel-2);position:sticky;top:0;z-index:120;
    box-shadow:0 6px 30px rgba(0,0,0,.6)
  }
  .topbar h1{margin:0;text-align:center;color:var(--accent);font-size:20px;user-select:none;cursor:pointer}
  .top-left,.top-right{display:flex;align-items:center;gap:8px}

  /* Admin indicator */
  .admin-bar{
    position:fixed;left:12px;top:70px;background:rgba(11,11,11,.9);border:1px solid #2d2d2d;padding:8px 10px;border-radius:10px;z-index:200;
    display:none;align-items:center;gap:8px;
  }
  .admin-bar.show{display:flex}
  .admin-bar strong{color:var(--accent);font-size:13px}

  /* ---------- Pages wrapper ---------- */
  .page{display:none;min-height:calc(100dvh - 120px);padding:18px}
  .page.active{display:block}

  /* ---------- Center card (login / order status) ---------- */
  .center-wrap{display:grid;place-items:center;min-height:calc(100dvh - 120px)}
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
    padding:20px;border-radius:var(--radius);width:100%;max-width:720px;
    box-shadow:0 12px 36px rgba(0,0,0,.6);position:relative;
  }
  .muted{color:var(--muted);margin:8px 0}
  .field{display:grid;gap:8px;margin-bottom:12px}
  .field input{padding:12px;border-radius:10px;border:1px solid #222;background:#0d0d0d;color:var(--text)}

  /* ---------- Toolbar (Shop) ---------- */
  .toolbar{
    display:flex;gap:10px;align-items:center;justify-content:center;padding:12px;background:linear-gradient(180deg,#0d0d0d,#0b0b0b);
    border-bottom:1px solid #1b1b1b;position:sticky;top:66px;z-index:80
  }
  .toolbar input,.toolbar select{
    padding:10px;border-radius:10px;border:1px solid #232323;background:#0f0f0f;color:var(--text);min-width:180px;
  }

  /* ---------- Products grid ---------- */
  .products{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;padding:18px}
  .product{
    background:var(--panel);border-radius:12px;padding:12px;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,.55);
    transition:transform .2s;position:relative;overflow:visible;
  }
  .product:hover{transform:translateY(-6px)}
  .product img{width:100%;height:150px;object-fit:cover;border-radius:10px}
  .product.sold img{filter:grayscale(80%) brightness(.7);opacity:.95}
  .product h3{margin:10px 0 6px;color:var(--accent);font-size:16px}
  .product p{margin:0 0 10px;color:var(--muted)}

  /* ---------- SOLD ribbon ---------- */
  .ribbon {
    position:absolute;
    left: -38px;
    top: 16px;
    transform: rotate(-45deg);
    width: 170px;
    text-align: center;
    background: linear-gradient(90deg,var(--danger),#c92b2b);
    color:#fff;
    font-weight:800;
    font-size:13px;
    padding:6px 0;
    box-shadow:0 6px 20px rgba(0,0,0,.5);
    z-index:30;
    border-radius:4px;
    letter-spacing:1px;
  }

  /* CLOSED ribbon */
  .closed-ribbon {
    position:absolute;
    left: -38px;
    top: 16px;
    transform: rotate(-45deg);
    width: 170px;
    text-align: center;
    background: linear-gradient(90deg,#ff7300,#c92b2b);
    color:#fff;
    font-weight:800;
    font-size:13px;
    padding:6px 0;
    box-shadow:0 6px 20px rgba(0,0,0,.5);
    z-index:30;
    border-radius:4px;
    letter-spacing:1px;
  }

  /* admin toggle */
  .admin-toggle{
    position:absolute;right:8px;top:8px;background:rgba(0,0,0,.45);border:1px solid #222;padding:6px;border-radius:8px;font-size:12px;z-index:40;
    display:none;
  }
  .admin-toggle.show{display:inline-flex;align-items:center;gap:8px}

  /* ---------- Cart sidebar ---------- */
  #cartSidebar{
    position:fixed;top:0;right:-420px;width:380px;height:100%;background:#0b0b0b;border-left:1px solid #222;
    box-shadow:-8px 0 40px rgba(0,0,0,.7);padding:18px;transition:right .28s ease;z-index:200
  }
  #cartSidebar.show{right:0}
  .cart-head{display:flex;align-items:center;justify-content:space-between}
  .customer-summary{font-size:13px;color:var(--muted);background:#0d0d0d;padding:10px;border-radius:10px;margin:10px 0}
  .cart-list{list-style:none;padding:0;margin:10px 0;display:grid;gap:8px}
  .cart-item{display:grid;grid-template-columns:1fr auto auto;gap:8px;align-items:center;background:#101010;padding:10px;border-radius:10px}
  .cart-item .price{color:var(--text);opacity:.95}
  .cart-item .qty{display:flex;align-items:center;gap:8px}
  .cart-item .qty button{padding:6px 10px;font-size:12px}

  .delivery-box{background:#0d0d0d;padding:12px;border-radius:12px;margin-top:10px}
  .total-line{display:flex;justify-content:space-between;align-items:center;margin:12px 0;font-size:18px}

  /* ---------- Buttons ---------- */
  .btn, button { padding:12px 16px;border:2px solid #fff;outline:none;color:#fff;background:#151515;cursor:pointer;
    position:relative;z-index:0;border-radius:12px;font-weight:700;letter-spacing:.4px;transition:transform .18s,box-shadow .18s,border-color .18s;
  }
  .btn.small{padding:8px 10px;font-size:13px}
  .btn.ghost{background:transparent;border-color:#404040}
  .btn.danger{border-color:var(--danger)}
  .btn::before, button::before{
    content:"";position:absolute;inset:0;border-radius:12px;
    background:linear-gradient(45deg,#ff0000,#ff7300,#fffb00,#48ff00,#00ffd5,#002bff,#ff00c8,#ff0000);
    background-size:600%;z-index:-1;filter:blur(8px);animation:glow 10s linear infinite;opacity:.7;
  }
  .btn::after, button::after{content:"";position:absolute;inset:0;border-radius:12px;background:#151515;z-index:-1}
  @keyframes glow{0%{background-position:0 0}50%{background-position:400% 0}100%{background-position:0 0}}
  .btn:hover, button:hover{border-color:var(--accent);transform:translateY(-2px);box-shadow:0 6px 30px rgba(255,255,255,.04)}
  .btn:active, button:active{transform:translateY(0) scale(.99);border-color:#48ff00}

  /* ---------- Order status ---------- */
  .timer{font-size:36px;font-weight:800;color:var(--accent);text-align:center;margin-top:6px}
  .stack{display:grid;gap:12px}
  .footer-note{text-align:center;color:var(--muted);padding:14px}

  /* modal admin */
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:260}
  .modal-backdrop.show{display:flex}
  .modal{background:var(--panel);padding:18px;border-radius:12px;width:320px;box-shadow:0 12px 40px rgba(0,0,0,.6)}
  .modal input{width:100%;padding:10px;border-radius:8px;border:1px solid #333;background:#0f0f0f;color:var(--text);margin-top:8px}

  @media (max-width:720px){
    #cartSidebar{width:92vw}
    .product img{height:120px}
    .toolbar{flex-direction:column;gap:8px}
    .admin-bar{left:8px;top:80px}
  }
</style>
</head>
<body>
<!-- TOPBAR -->
<div class="topbar">
  <div class="top-left"></div>
  <h1 id="appTitle" title="Double-click to open admin">7alan Mart 🛒</h1>
  <div class="top-right"></div>
</div>

<!-- Admin bar -->
<div class="admin-bar" id="adminBar">
  <strong>ADMIN MODE</strong>
  <button class="btn small" id="adminLogoutBtn">Logout</button>
  <button class="btn small" id="toggleClosedBtn">Toggle Closed</button>
</div>

<!-- Admin login modal -->
<div class="modal-backdrop" id="adminModal">
  <div class="modal">
    <h3>Admin Login</h3>
    <p class="muted">Enter admin password to unlock product controls.</p>
    <input id="adminPassword" type="password" placeholder="Password" />
    <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
      <button class="btn small" id="adminLoginBtn">Unlock</button>
      <button class="btn small ghost" id="adminCancelBtn">Cancel</button>
    </div>
  </div>
</div>

<!-- PAGE: LOGIN -->
<section id="page-start" class="page active">
  <div class="center-wrap">
    <form id="customerForm" class="card" autocomplete="off">
      <!-- Closed ribbon - only visible when store is closed -->
      <div id="closedRibbon" class="closed-ribbon" style="display: none;">CLOSED</div>
      
      <h2>Welcome 👋</h2>
      <p class="muted">Enter your name & address (Delivery limited to Nakheel).</p>
      <label class="field"><span>Name</span><input id="custName" type="text" placeholder="Your name" required /></label>
      <label class="field"><span>Address (Nakheel)</span><input id="custAddress" type="text" placeholder="Street / Building / Flat" required /></label>
      <div class="stack">
        <button class="btn" type="submit" id="continueBtn">Continue to Shop</button>
      </div>
    </form>
  </div>
  <div class="footer-note">This is a demo app. WhatsApp messages open in a new tab to send orders/cancellations.</div>
</section>

<!-- PAGE: SHOP -->
<section id="page-shop" class="page">
  <div class="toolbar">
    <input id="searchBar" type="text" placeholder="🔍 Search snacks..." />
    <select id="filterCategory">
      <option value="all">All</option>
      <option value="chips">Chips</option>
      <option value="drinks">Drinks</option>
      <option value="chocolate">Chocolate</option>
      <option value="candy">Candy</option>
    </select>
    <div style="flex:1"></div>
    <button class="btn small" id="cartBtn">View Cart</button>
  </div>
  <main class="page-content">
    <section id="products" class="products" aria-live="polite"></section>
  </main>

  <!-- CART SIDEBAR -->
  <aside id="cartSidebar">
    <div class="cart-head">
      <h2>Your Cart</h2>
      <button class="btn small" id="closeCartBtn">✖</button>
    </div>
    <div id="customerSummary" class="customer-summary"></div>
    <ul id="cartItems" class="cart-list" aria-live="polite"></ul>
    <div class="delivery-box">
      <h3>Delivery</h3>
      <label><input type="radio" name="delivery" value="slow" checked /> 🐢 Slow (30–40 min) – 20 LE</label>
      <label><input type="radio" name="delivery" value="fast" /> 🚀 Fast (15–20 min) – 40 LE</label>
    </div>
    <div class="total-line"><span>Subtotal + Delivery</span><strong id="cartTotal">0 LE</strong></div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;margin-top:10px;">
      <button class="btn" id="sendOrderBtn">✅ Send Order</button>
      <button class="btn ghost" id="clearCartBtn">🧹 Clear Cart</button>
    </div>
  </aside>
</section>

<!-- PAGE: ORDER STATUS -->
<section id="page-cancel" class="page">
  <div class="center-wrap">
    <div class="card" id="orderCard">
      <h2>Order placed ✅</h2>
      <p class="muted">Your order was sent. You can cancel from this page if needed.</p>
      <div id="orderSummary" class="customer-summary"></div>
      <div style="text-align:center;margin-top:10px;">
        <div><strong>Estimated delivery window</strong></div>
        <div id="deliveryWindow" style="margin-top:8px;font-size:16px;color:var(--accent)"></div>
        <div class="timer" id="timerDisplay">--:--</div>
        <div class="muted" style="font-size:13px">Time remaining</div>
      </div>
      <div class="stack" style="margin-top:14px;">
        <button class="btn danger" id="cancelOrderBtn">❌ Cancel Order</button>
        <button class="btn ghost" id="backToShopBtn">Back to Shop</button>
      </div>
    </div>
  </div>
</section>

<script>
const WHATSAPP_PHONE = "201553370060";
const ADMIN_PASSWORD = "1252";
const FAST_MINUTES = 20;
const SLOW_MINUTES = 40;

const productsData = [
  { id: 'chips-salt', name:"Chipsy — Salt", price:15, category:"chips", image:"images/chipsy-salt.png" },
  { id: 'chips-onion', name:"Chipsy — Onion & Cheese", price:15, category:"chips", image:"images/chipsy-onion.png" },
  { id: 'chips-cheese', name:"Chipsy — Cheese", price:15, category:"chips", image:"images/chipsy-cheese.png" },
  { id: 'chips-tomato', name:"Chipsy — Tomato", price:15, category:"chips", image:"images/chipsy-Tomato.png" },
  { id: 'chips-kebab', name:"Chipsy — Kebab", price:15, category:"chips", image:"images/chipsy-kabab.png" },

  { id: 'pepsi-can', name:"Pepsi Can", price:15, category:"drinks", image:"images/pepsi-can.png" },
  { id: 'coke-can', name:"Coca-Cola Can", price:15, category:"drinks", image:"images/coke-can.png" },
  { id: 'sting-drink', name:"Sting Energy Drink", price:20, category:"drinks", image:"images/sting-dring.png" },
  { id: 'fury-drink', name:"Fury Energy Drink", price:20, category:"drinks", image:"images/fury-drink.png" },

  { id: 'galaxy', name:"Galaxy Bar", price:30, category:"chocolate", image:"images/galaxy.png" },
  { id: 'twix', name:"Twix", price:30, category:"chocolate", image:"images/twix.png" },
  { id: 'snickers', name:"Snickers", price:30, category:"chocolate", image:"images/snickers.png" },
  { id: 'kitkat', name:"KitKat 2-Finger", price:30, category:"chocolate", image:"images/kitkat.png" },

  { id: 'gummy', name:"Gummy Bears", price:40, category:"candy", image:"images/gummy.png" }
];

function save(k,v){localStorage.setItem(k,JSON.stringify(v))}
function load(k,d=null){const raw=localStorage.getItem(k);return raw?JSON.parse(raw):d}
function getCustomer(){return {name:load("custName",""),address:load("custAddress","")}}
function setCustomer(name,address){save("custName",name);save("custAddress",address)}
function getCart(){return load("cart",[])}
function setCart(c){save("cart",c)}
function saveOrder(order){save("lastOrder",order)}
function getOrder(){return load("lastOrder",null)}
function clearOrder(){localStorage.removeItem("lastOrder")}
function getSoldMap(){return load("soldMap",{})}
function setSoldMap(m){save("soldMap",m)}
function isAdmin(){return !!load("isAdmin",false)}
function setAdmin(v){save("isAdmin",!!v)}
function isClosed(){return !!load("isClosed",false)}
function setClosed(v){save("isClosed",!!v)}

const $=sel=>document.querySelector(sel)
const $$=sel=>Array.from(document.querySelectorAll(sel))

function showPage(id){
  $$('.page').forEach(p=>p.classList.remove('active'));
  $('#'+id).classList.add('active');
  window.scrollTo(0,0)
}

/* ---------- Admin ---------- */
const adminModal=$('#adminModal'), adminBar=$('#adminBar'), adminPasswordInput=$('#adminPassword'), adminLoginBtn=$('#adminLoginBtn'), adminCancelBtn=$('#adminCancelBtn'), appTitle=$('#appTitle'), adminLogoutBtn=$('#adminLogoutBtn'), toggleClosedBtn=$('#toggleClosedBtn')
 // Password changed from 1234 to 1252 above in ADMIN_PASSWORD
appTitle.addEventListener('dblclick',()=>{adminPasswordInput.value='';adminModal.classList.add('show');adminPasswordInput.focus()})
adminCancelBtn.addEventListener('click',()=>adminModal.classList.remove('show'))
adminLoginBtn.addEventListener('click',()=>{
  if(adminPasswordInput.value.trim()===ADMIN_PASSWORD){setAdmin(true);adminModal.classList.remove('show');refreshAdminUI();alert('Admin unlocked')}
  else alert('Wrong password')
})
adminLogoutBtn.addEventListener('click',()=>{setAdmin(false);refreshAdminUI();alert('Logged out of Admin')})
toggleClosedBtn.addEventListener('click',()=>{
  setClosed(!isClosed());
  updateClosedUI();
  alert(`Store is now ${isClosed() ? 'CLOSED' : 'OPEN'}`);
})
document.addEventListener('keydown',e=>{if(e.ctrlKey && e.shiftKey && e.code==='KeyA'){adminPasswordInput.value='';adminModal.classList.add('show');adminPasswordInput.focus()}})

/* ---------- Login ---------- */
$('#customerForm').addEventListener('submit',e=>{
  e.preventDefault()
  if (isClosed()) {
    alert("Sorry, we're currently closed. Please try again later.");
    return;
  }
  
  const n=$('#custName').value.trim(),a=$('#custAddress').value.trim()
  if(!n||!a){alert('Please fill name and address.');return;}
  setCustomer(n,a);showPage('page-shop');renderProducts()
})
$('#custName').value=getCustomer().name||''
$('#custAddress').value=getCustomer().address||''

/* ---------- Shop ---------- */
function renderProducts(){
  const productsEl=$('#products'),q=($('#searchBar').value||'').toLowerCase(),cat=$('#filterCategory').value,soldMap=getSoldMap(),adminOn=isAdmin()
  productsEl.innerHTML=''
  productsData.filter(p=>(cat==='all'||p.category===cat)).filter(p=>p.name.toLowerCase().includes(q)).forEach((p,i)=>{
    const sold=!!soldMap[p.id]
    const card=document.createElement('div')
    card.className='product'+(sold?' sold':'');card.dataset.id=p.id
    card.innerHTML=`
      ${sold?'<div class="ribbon">SOLD OUT</div>':''}
      <div class="admin-toggle ${adminOn?'show':''}" data-id="${p.id}">
        <button class="btn small admin-btn" data-id="${p.id}">${sold?'Make Available':'Mark Sold'}</button>
      </div>
      <img src="${p.image}" alt="${p.name}">
      <h3>${p.name}</h3>
      <p>${p.price} LE</p>
      <div style="display:flex;justify-content:center">
        <button class="btn small addBtn" data-index="${i}" ${sold||isClosed()?'disabled':''}>Add to Cart</button>
      </div>
    `
    productsEl.appendChild(card)
    card.addEventListener('mouseenter',()=>card.dataset.hovered='1')
    card.addEventListener('mouseleave',()=>delete card.dataset.hovered)
  })
  $$('.admin-btn').forEach(btn=>btn.onclick=()=>{toggleSold(btn.dataset.id);renderProducts()})
}
$('#searchBar').addEventListener('input',renderProducts)
$('#filterCategory').addEventListener('change',renderProducts)

/* ---------- Cart ---------- */
function updateCartUI(){
  const cartItemsEl=$('#cartItems'),cartTotalEl=$('#cartTotal'),cart=getCart()
  cartItemsEl.innerHTML='';let subtotal=0
  cart.forEach((c,i)=>{subtotal+=c.price*c.qty
    const li=document.createElement('li')
    li.className='cart-item'
    li.innerHTML=`
      <span>${c.name}</span>
      <span class="price">${c.price} LE</span>
      <span class="qty">
        <button class="btn small" onclick="decItem(${i})">-</button>
        <strong>${c.qty}</strong>
        <button class="btn small" onclick="incItem(${i})">+</button>
      </span>
    `
    cartItemsEl.appendChild(li)
  })
  const d=document.querySelector("input[name='delivery']:checked").value
  const total=subtotal + (d==='fast'?40:20)
  cartTotalEl.textContent=`${total} LE`
}
window.incItem=i=>{const cart=getCart();if(!cart[i])return;cart[i].qty++;setCart(cart);updateCartUI()}
window.decItem=i=>{const cart=getCart();if(!cart[i])return;cart[i].qty--;if(cart[i].qty<=0)cart.splice(i,1);setCart(cart);updateCartUI()}
function addToCart(prod){if(getSoldMap()[prod.id] || isClosed()){alert("This item is not available.");return;}const cart=getCart();const f=cart.find(c=>c.id===prod.id);f?f.qty++:cart.push({id:prod.id,name:prod.name,price:prod.price,qty:1});setCart(cart);updateCartUI()}
$('#products').addEventListener('click',e=>{const btn=e.target.closest('.addBtn');if(!btn)return;if(btn.disabled){alert("This item is not available.");return;}addToCart(productsData[+btn.dataset.index]);openCart()})
$('#cartBtn').addEventListener('click',()=>{if(isClosed()){alert("Sorry, we're currently closed.");return;}$('#cartSidebar').classList.toggle('show');updateCartUI()})
$('#closeCartBtn').addEventListener('click',()=>$('#cartSidebar').classList.remove('show'))
$('#clearCartBtn').addEventListener('click',()=>{if(!confirm("Clear the cart?"))return;setCart([]);updateCartUI()})
window.openCart=()=>{$('#cartSidebar').classList.add('show');updateCartUI()}

/* ---------- Send Order ---------- */
$('#sendOrderBtn').addEventListener('click',()=>{
  if (isClosed()) {
    alert("Sorry, we're currently closed and cannot accept orders.");
    return;
  }
  
  const cart=getCart();if(cart.length===0){alert("Your cart is empty.");return;}const d=document.querySelector("input[name='delivery']:checked").value,dCost=(d==='fast'?40:20),subtotal=cart.reduce((s,c)=>s+c.price*c.qty,0),total=subtotal+dCost,cust=getCustomer(),itemsText=cart.map(c=>`${c.name} x${c.qty} (${c.price} LE)`).join(", "),message=`New Order – 7alan Mart\nName: ${cust.name||'-'}\nAddress: ${cust.address||'-'}\nItems: ${itemsText}\nDelivery: ${d==='fast'?"🚀 Fast (15–20 min, 40 LE)":"🐢 Slow (30–40 min, 20 LE)"}\nSubtotal: ${subtotal} LE\nTotal: ${total} LE`,order={createdAt:Date.now(),deliveryType:d,durationMinutes:(d==='fast'?FAST_MINUTES:SLOW_MINUTES),items:cart,subtotal,deliveryCost:dCost,total};saveOrder(order);window.open(`https://wa.me/${WHATSAPP_PHONE}?text=${encodeURIComponent(message)}`,"_blank");setTimeout(()=>{showPage('page-cancel');initOrderStatus()},350)})

/* ---------- Order Status ---------- */
function initOrderStatus(){
  const order=getOrder(),orderSummaryEl=$('#orderSummary'),timerEl=$('#timerDisplay'),deliveryWindowEl=$('#deliveryWindow'),cancelBtn=$('#cancelOrderBtn'),backToShopBtn=$('#backToShopBtn')
  if(!order){orderSummaryEl.textContent='No recent order found.';timerEl.textContent='--:--';deliveryWindowEl.textContent='';cancelBtn.disabled=true;return;}
  orderSummaryEl.innerHTML=`<strong>Items:</strong> ${order.items.map(i=>i.name+" x"+i.qty+" ("+i.price+" LE)").join(', ')}<br><strong>Subtotal:</strong> ${order.subtotal} LE<br><strong>Delivery:</strong> ${order.deliveryType==='fast'?'Fast (15–20 min)':'Slow (30–40 min)'}<br><strong>Total:</strong> ${order.total} LE`
  deliveryWindowEl.textContent=order.deliveryType==='fast'?'15–20 minutes':'30–40 minutes'
  const endTime=order.createdAt+order.durationMinutes*60*1000
  const timerInterval=setInterval(()=>{
    const diff=Math.max(0,endTime-Date.now()),minutes=Math.floor(diff/60000),seconds=Math.floor((diff%60000)/1000)
    timerEl.textContent=`${String(minutes).padStart(2,'0')}:${String(seconds).padStart(2,'0')}`
    if(diff<=0){clearInterval(timerInterval);timerEl.textContent='Delivered ✅';cancelBtn.disabled=true}
  },1000)
  cancelBtn.addEventListener('click',()=>{
    if(!confirm('Send cancel message and clear order?'))return
    const cust=getCustomer(),message=`❌ Order Canceled – 7alan Mart\nCustomer: ${cust.name||'-'}\nAddress: ${cust.address||'-'}\nOriginal items: ${order.items.map(i=>i.name+" x"+i.qty).join(', ')}`
    setCart([]);clearOrder();window.open(`https://wa.me/${WHATSAPP_PHONE}?text=${encodeURIComponent(message)}`,"_blank")
    orderSummaryEl.textContent='Order canceled. A cancel message was opened in WhatsApp.';timerEl.textContent='--:--';cancelBtn.disabled=true
  })
  backToShopBtn.addEventListener('click',()=>showPage('page-shop'))
}

/* ---------- SOLD logic ---------- */
function toggleSold(productId){const m=getSoldMap();m[productId]?delete m[productId]:m[productId]=true;setSoldMap(m)}

/* ---------- CLOSED logic ---------- */
function updateClosedUI() {
  const closed = isClosed();
  const closedRibbon = $('#closedRibbon');
  const continueBtn = $('#continueBtn');
  
  // Show/hide closed ribbon
  closedRibbon.style.display = closed ? 'block' : 'none';
  
  // Disable/enable continue button
  continueBtn.disabled = closed;
  
  // Update shop page if needed
  if (document.getElementById('page-shop').classList.contains('active')) {
    renderProducts();
  }
}

function refreshAdminUI(){
  if(isAdmin()) {
    $('#adminBar').classList.add('show');
    // Add toggle closed button to admin bar if not already there
    if (!document.querySelector('#toggleClosedBtn')) {
      adminBar.innerHTML += '<button class="btn small" id="toggleClosedBtn">Toggle Closed</button>';
      $('#toggleClosedBtn').addEventListener('click', () => {
        setClosed(!isClosed());
        updateClosedUI();
        alert(`Store is now ${isClosed() ? 'CLOSED' : 'OPEN'}`);
      });
    }
  } else {
    $('#adminBar').classList.remove('show');
  }
  renderProducts();
  updateClosedUI();
}

window.addEventListener('load',()=>{
  refreshAdminUI();
  renderProducts();
  updateClosedUI();
  
  $('#adminModal').addEventListener('click',e=>{
    if(e.target==$('#adminModal')) adminModal.classList.remove('show')
  });
  
  document.addEventListener('keydown',ev=>{
    if(ev.code==='KeyA'&&isAdmin()){
      const hovered=document.querySelector('.product[data-id][data-hovered="1"]');
      if(hovered){
        toggleSold(hovered.dataset.id);
        renderProducts();
      }
    }
  });
});
</script>
</body>
</html>